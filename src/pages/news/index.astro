---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageHeader from '../../components/PageHeader.astro';
import { getCollection } from 'astro:content';

// Get news from content collection, sorted by date (newest first)
const newsEntries = await getCollection('news');
const posts = newsEntries
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .map(post => ({
    title: post.data.title,
    date: post.data.date.toLocaleDateString('en-GB', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }),
    excerpt: post.data.excerpt,
    type: post.data.featured ? 'newsletter' : 'news',
    slug: post.slug,
  }));
---

<BaseLayout title="News & Updates">
  <PageHeader
    title="News & Updates"
    subtitle="The latest from All Saints of Lincolnshire"
  />

  <section class="py-20 bg-white">
    <div class="max-w-4xl mx-auto px-6">
      <div class="space-y-8">
        {posts.map((post) => (
          <article class="p-6 bg-off-white rounded-xl border border-black/5 hover:shadow-lg transition-shadow">
            <div class="flex items-center gap-3 mb-3">
              <span class={`px-3 py-1 rounded-full text-xs font-heading uppercase tracking-wide ${
                post.type === 'newsletter' ? 'bg-gold text-navy' : 'bg-navy text-white'
              }`}>
                {post.type}
              </span>
              <span class="text-slate text-sm">{post.date}</span>
            </div>
            <h2 class="font-heading text-xl uppercase tracking-wide text-navy mb-3">
              {post.title}
            </h2>
            <p class="text-charcoal mb-4">{post.excerpt}</p>
            <a href={`/All-Saints/news/${post.slug}`} class="text-gold font-heading text-sm uppercase tracking-wide hover:underline">
              Read More â†’
            </a>
          </article>
        ))}
      </div>

      <div class="mt-12 p-6 bg-navy text-white rounded-xl text-center">
        <h3 class="font-heading text-lg uppercase tracking-wide mb-3">
          Subscribe to Our Newsletter
        </h3>
        <p class="text-white/70 text-sm mb-4">
          Receive Fr. Philip's monthly newsletter and parish updates directly in your inbox.
        </p>
        <p class="text-gold text-sm italic">
          Newsletter signup coming soon
        </p>
      </div>
    </div>
  </section>
</BaseLayout>
